{% extends 'main_page/base.html' %}
{% load static %}

{% block content %}
<main class="content post_style">
    <section class="wrap_post {% if not line.image %} ptb-30 {% endif %}">
        {% if line.image %}
        <img class="preview_img" src="{{ line.image.url }}" alt="post_image">
        <div class="line_parent">
            <div class="line"
                 style="background: {{ line.color }};"></div>
            <div class="circle" style="background: {{ line.color }}">
                <p style="color: {{ line.color_text }};">{{ line.number }}</p>
            </div>
        </div>
        {% else %}
        <div class="line_parent mt-20">
            <div class="line"
                 style="background: linear-gradient(90deg, rgba(0,0,0,0) 0%, {{ line.color }} 10%, {{ line.color }} 90%, rgba(0,0,0,0) 100%);"></div>
            <div class="circle" style="background: {{ line.color }}">
                <p style="color: {{ line.color_text }};">{{ line.number }}</p>
            </div>
        </div>
        {% endif %}
                <ul class="vertical_stations_list">
            {% for st in line.station_set.all %}
                {% for d in depot %}
                    {% if d.index == 0 and st.index == 1 and d.main_line == st.line %}
                        <li class="element">
                        <a class="line_link_image" href="{{ d.get_absolute_url }}">
                            {% if d.status == 'Эксплуатируется' %}
                            <svg width="110" height="110" xmlns="http://www.w3.org/2000/svg">
                                <!-- Created with SVG Editor - http://github.com/mzalive/SVG Editor/ -->
                                <defs>
                                    <filter height="200%" width="200%" y="-50%" x="-50%" id="svg_7_blur">
                                        <feGaussianBlur stdDeviation="1" in="SourceGraphic"/>
                                    </filter>
                                </defs>
                                <g>
                                    <title>background</title>
                                    <rect x="-1" y="-1" width="112" height="112" id="canvas_background" fill="none"/>
                                    <g id="canvasGrid" display="none">
                                        <rect id="svg_3" width="100%" height="100%" x="0" y="0" stroke-width="0"
                                              fill="url(#gridpattern)"/>
                                    </g>
                                </g>
                                <g>
                                    <title>Layer 1</title>
                                    <rect fill="{{ line.color }}" stroke-width="0" x="15" y="0" width="20" height="10" id="svg_1"
                                          stroke="#000"/>
                                    <rect fill="{{ line.color }}" stroke-width="0" x="15" y="99.99998" width="20" height="10" id="svg_2"
                                          stroke="#000"/>
                                    <rect rx="10" fill="{{ line.color }}" stroke-width="0" stroke-opacity="null" fill-opacity="null"
                                          y="10" width="50" height="90" id="svg_4" stroke="#000"/>
                                    <rect rx="5" fill="#ffffff" stroke-width="0" stroke-opacity="null" x="9.85296" y="20"
                                          width="30" height="70" id="svg_5" stroke="#000"/>
                                    <rect stroke="#000" id="svg_7" height="30" width="30" y="40" x="9.80775"
                                          stroke-width="0" fill="{{ line.color }}"/>
                                    <text style="cursor: move;" fill="{{ line.color_text }}" stroke-width="0" stroke-opacity="null"
                                          x="13.20045" y="64.75061" id="svg_6" font-size="24" font-family="Euphoria, sans-serif"
                                          text-anchor="start" xml:space="preserve"
                                          transform="matrix(0.8899122355379762,0,0,1.0000902719207967,-2.254208887958093,-3.003364534707523) "
                                          stroke="#000" font-weight="bold" font-style="italic">ТЧ</text>
                                </g>
                            </svg>
                            {% else %}
                            <svg width="110" height="110" xmlns="http://www.w3.org/2000/svg">
                                <!-- Created with SVG Editor - http://github.com/mzalive/SVG Editor/ -->
                                <defs>
                                    <filter height="200%" width="200%" y="-50%" x="-50%" id="svg_7_blur">
                                        <feGaussianBlur stdDeviation="1" in="SourceGraphic"/>
                                    </filter>
                                </defs>
                                <g>
                                    <title>background</title>
                                    <rect x="-1" y="-1" width="112" height="112" id="canvas_background" fill="none"/>
                                    <g id="canvasGrid" display="none">
                                        <rect id="svg_3" width="100%" height="100%" x="0" y="0" stroke-width="0"
                                              fill="url(#gridpattern)"/>
                                    </g>
                                </g>
                                <g>
                                    <title>Layer 1</title>
                                    <rect fill="{{ line.color }}80" stroke-width="0" x="15" y="0" width="20" height="10" id="svg_1"
                                          stroke="#000"/>
                                    <rect fill="{{ line.color }}80" stroke-width="0" x="15" y="99.99998" width="20" height="10" id="svg_2"
                                          stroke="#000"/>
                                    <rect rx="10" fill="{{ line.color }}80" stroke-width="0" stroke-opacity="null" fill-opacity="null"
                                          y="10" width="50" height="90" id="svg_4" stroke="#000"/>
                                    <rect rx="5" fill="#ffffff" stroke-width="0" stroke-opacity="null" x="9.85296" y="20"
                                          width="30" height="70" id="svg_5" stroke="#000"/>
                                    <rect stroke="#000" id="svg_7" height="30" width="30" y="40" x="9.80775"
                                          stroke-width="0" fill="{{ line.color }}80"/>
                                    <text style="cursor: move;" fill="{{ line.color_text }}80" stroke-width="0" stroke-opacity="null"
                                          x="13.20045" y="64.75061" id="svg_6" font-size="24" font-family="Euphoria, sans-serif"
                                          text-anchor="start" xml:space="preserve"
                                          transform="matrix(0.8899122355379762,0,0,1.0000902719207967,-2.254208887958093,-3.003364534707523) "
                                          stroke="#000" font-weight="bold" font-style="italic">ТЧ</text>
                                </g>
                            </svg>
                            {% endif %}
                            {% if d.image %}
                            <img class="station_img" src="{{ d.image.url }}" alt="{{ d.title }}">
                            {% else %}
                            <img class="station_img" src="{% static 'images/plug.jpg' %}" alt="post_image">
                            {% endif %}
                        </a>

                        <div class="vertical_stations_info_block">
                            <a class="line_link_text" style="margin: 0 auto;" href="{{ d.get_absolute_url }}">
                                <div class="station_text">
                                    <h2 class="list_title">ТЧ-{{ d.number_of_depot }} {{ d.title | truncatechars:30 }}</h2>
                                    <p>Состояние: {{ d.status }}</p>
                                </div>
                            </a>
                        </div>
                    </li>
                    {% endif %}
                {% endfor %}
            <li class="element">
                    <a class="line_link_image" href="{{ st.get_absolute_url }}">
                        {% if st.path_direction == 'Основной путь' %}
                        <svg width="110" height="110" xmlns="http://www.w3.org/2000/svg">
                            <!-- Created with SVG Editor - http://github.com/mzalive/SVG Editor/ -->
                            <g>
                                <rect x="-1" y="-1" width="36.37497" height="36.37497" id="canvas_background" fill="none"/>
                                <g id="canvasGrid" display="none">
                                    <rect id="svg_3" width="100%" height="100%" x="0" y="0" stroke-width="0"
                                          fill="url(#gridpattern)"/>
                                </g>
                            </g>
                            <g>
                                {% if st.prev_path == 'Эксплуатируется' %}
                                <rect id="svg_1" height="55" width="20" y="0" x="15" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}"/>
                                {% elif st.prev_path == 'Строится' %}
                                <rect id="svg_1" height="55" width="20" y="0" x="15" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}80"/>
                                {% endif %}
                                {% if st.next_path == 'Эксплуатируется' %}
                                <rect id="svg_2" height="55" width="20" y="55" x="15" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}"/>
                                {% elif st.next_path == 'Строится' %}
                                <rect id="svg_2" height="55" width="20" y="55" x="15" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}80"/>
                                {% endif %}
                                <ellipse ry="20" rx="20" id="svg_3" cy="55" cx="25" stroke-width="0" stroke="#000"
                                         fill="#ffffff"/>
                                {% if st.status == 'Эксплуатируется' %}
                                <ellipse ry="18" rx="18" id="svg_5" cy="55" cx="25" stroke-width="0" stroke="#000"
                                         fill="{{ line.color }}"/>
                                {% else %}
                                <ellipse ry="18" rx="18" id="svg_5" cy="55" cx="25" stroke-width="0" stroke="#000"
                                         fill="{{ line.color }}80"/>
                                {% endif %}
                                <ellipse ry="9" rx="9" id="svg_6" cy="55" cx="25" stroke-width="0" stroke="#000"
                                         fill="#ffffff"/>
                            </g>
                        </svg>
                        {% elif st.path_direction == 'Ответвление' %}
                        <svg width="110" height="110" xmlns="http://www.w3.org/2000/svg">
                            <!-- Created with SVG Editor - http://github.com/mzalive/SVG Editor/ -->

                            <g>
                                <title>background</title>
                                <rect x="-1" y="-1" width="36.37497" height="36.37497" id="canvas_background" fill="none"/>
                                <g id="canvasGrid" display="none">
                                    <rect id="svg_3" width="100%" height="100%" x="0" y="0" stroke-width="0"
                                          fill="url(#gridpattern)"/>
                                </g>
                            </g>
                            <g>
                                <title>Layer 1</title>
                                <rect fill="{{ line.color }}" stroke="#000" stroke-width="0" x="15" y="0" width="20"
                                      height="55"
                                      id="svg_1"/>
                                <rect fill="{{ line.color }}" stroke="#000" stroke-width="0" x="15" y="55" width="20"
                                      height="55"
                                      id="svg_2"/>
                                {% if st.prev_path == 'Эксплуатируется'%}
                                <rect id="svg_4" height="55" width="20" y="0" x="60.84615" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}"/>
                                {% elif st.prev_path == 'Строится' %}
                                <rect id="svg_4" height="55" width="20" y="0" x="60.84615" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}80"/>
                                {% endif %}
                                {% if st.next_path == 'Эксплуатируется'%}
                                <rect id="svg_8" height="55" width="20" y="55" x="60.84615" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}"/>
                                {% elif st.next_path == 'Строится' %}
                                <rect id="svg_8" height="55" width="20" y="55" x="60.84615" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}80"/>
                                {% endif %}
                                <ellipse ry="20" rx="20" id="svg_10" cy="55" cx="70.84615" stroke-width="0" stroke="#000"
                                         fill="#ffffff"/>
                                {% if st.status == 'Эксплуатируется'%}
                                <ellipse ry="18" rx="18" id="svg_10" cy="55" cx="70.84615" stroke-width="0" stroke="#000"
                                         fill="{{ line.color }}"/>
                                {% else %}
                                <ellipse ry="18" rx="18" id="svg_10" cy="55" cx="70.84615" stroke-width="0" stroke="#000"
                                         fill="{{ line.color }}80"/>
                                {% endif %}
                                <ellipse ry="9" rx="9" id="svg_11" cy="55" cx="70.84615" stroke-width="0" stroke="#000"
                                         fill="#ffffff"/>
                            </g>
                        </svg>
                        {% else %}
                        <svg width="110" height="110" xmlns="http://www.w3.org/2000/svg">
                            <!-- Created with SVG Editor - http://github.com/mzalive/SVG Editor/ -->

                            <g>
                                <title>background</title>
                                <rect x="-1" y="-1" width="112" height="112" id="canvas_background" fill="none"/>
                                <g id="canvasGrid" display="none">
                                    <rect id="svg_3" width="100%" height="100%" x="0" y="0" stroke-width="0"
                                          fill="url(#gridpattern)"/>
                                </g>
                            </g>
                            <g>
                                <title>Layer 1</title>
                                {% if st.prev_path == 'Эксплуатируется'%}
                                <rect id="svg_1" height="55" width="20" y="0" x="15" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}"/>
                                {% elif st.prev_path == 'Строится' %}
                                <rect id="svg_1" height="55" width="20" y="0" x="15" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}80"/>
                                {% endif %}
                                {% if st.next_path == 'Эксплуатируется'%}
                                <rect id="svg_2" height="55" width="20" y="55" x="15" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}"/>
                                {% elif st.next_path == 'Строится' %}
                                <rect id="svg_2" height="55" width="20" y="55" x="15" stroke-width="0" stroke="#000"
                                      fill="{{ line.color }}80"/>
                                {% endif %}

                                {% if st.path_direction == 'Начало ответвления'%}
                                <ellipse stroke="#000" fill="{{ line.color }}" stroke-width="0" stroke-opacity="null"
                                         cx="69.99999"
                                         cy="95.9726" id="svg_12" rx="10.46874" ry="11.09374"/>
                                <rect id="svg_12" height="55" width="20" y="98.25066" x="60.84615" stroke-width="0"
                                      stroke="#000"
                                      fill="{{ line.color }}"/>
                                <rect fill="{{ line.color }}" stroke-width="0" stroke-opacity="null" x="14.21764"
                                      y="62.71176"
                                      width="63.75219" height="20" id="svg_7"
                                      transform="rotate(45 46.09373092651368,77.05960083007814) " stroke="#000"/>
                                {% endif %}

                                {% if st.path_direction == 'Конец ответвления'%}
                                <rect fill="{{ line.color }}" stroke-width="0" stroke-opacity="null" x="15.0872"
                                      y="31.69733"
                                      width="63.75219" height="20" id="svg_14"
                                      transform="rotate(-45 46.96329879760741,41.69717407226562) " stroke="#000"/>
                                <ellipse stroke="#000" fill="{{ line.color }}" stroke-width="0" stroke-opacity="null"
                                         cx="69.99999"
                                         cy="17.47825" id="svg_17" rx="10.46874" ry="11.09374"/>
                                <rect id="svg_4" height="27.52038" width="20" y="-8.11591" x="60.84615" stroke-width="0"
                                      stroke="#000"
                                      fill="{{ line.color }}"/>
                                {% endif %}

                                <ellipse fill="#ffffff" stroke="#000" stroke-width="0" cx="25.38461" cy="55" id="svg_6"
                                         rx="20" ry="20"/>
                                {% if st.status == 'Эксплуатируется'%}
                                <ellipse ry="18" rx="18" id="svg_5" cy="55" cx="25" stroke-width="0" stroke="#000"
                                         fill="{{ line.color }}"/>
                                {% else %}
                                <ellipse ry="18" rx="18" id="svg_5" cy="55" cx="25" stroke-width="0" stroke="#000"
                                         fill="{{ line.color }}80"/>
                                {% endif %}
                                <ellipse fill="#ffffff" stroke="#000" stroke-width="0" cx="25.38461" cy="55" id="svg_11"
                                         rx="9" ry="9"/>
                            </g>
                        </svg>
                        {% endif %}
                        {% if st.image %}
                        <img class="station_img" src="{{ st.image.url }}" alt="{{ st.title }}">
                        {% else %}
                        <img class="station_img" src="{% static 'images/plug.jpg' %}" alt="post_image">
                        {% endif %}
                    </a>

                    <div class="vertical_stations_info_block">
                        <a class="line_link_text" style="margin: 0 auto;" href="{{ st.get_absolute_url }}">
                            <div class="station_text">
                                <h2 class="list_title">{{ st.title | truncatechars:30 }}</h2>
                                <p>Состояние: {{ st.status }}</p>
                            </div>
                        </a>
                        <ul class="trans_list">
                            {% for tr in st.transfer.all %}
                            <li class="{% if forloop.first and forloop.last %} w-100 {% else %} mw-210 {% endif %}"
                                title="{{ tr.line.title }} - {{ tr.title }}">

                                <a href="{{ tr.get_absolute_url }}">

                                    <div class="transfer_line transfer_hover
                                            {% if forloop.first and forloop.last %} simple-transfer {% endif %}"

                                         style="background:{% if tr.status == 'Эксплуатируется' %}{{ tr.line.color }}
                                                 {% else %}{{ tr.line.color }}80{% endif %};
                                                  --th:{% if tr.status == 'Эксплуатируется' %}{{ tr.line.color }}80
                                                  {% else %}{{ tr.line.color }}40{% endif %};">

                                                <span class="{% if forloop.first and forloop.last %} trans_title {% endif %}"
                                                      style="color:{{ tr.line.color_text }};
                                                      --tth:{{ tr.line.color_text }}80;">
                                                    {{ tr.line.number }}
                                                    {% if forloop.first and forloop.last %} {{ tr.title | truncatechars:13 }}{% endif %}
                                                </span>
                                    </div>
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </li>
                {% for d in depot %}
                    {% if d.index == st.index and d.main_line == st.line %}
                        <li class="element">
                        <a class="line_link_image" href="{{ d.get_absolute_url }}">
                            {% if d.status == 'Эксплуатируется' %}
                            <svg width="110" height="110" xmlns="http://www.w3.org/2000/svg">
                                <!-- Created with SVG Editor - http://github.com/mzalive/SVG Editor/ -->
                                <defs>
                                    <filter height="200%" width="200%" y="-50%" x="-50%" id="svg_7_blur">
                                        <feGaussianBlur stdDeviation="1" in="SourceGraphic"/>
                                    </filter>
                                </defs>
                                <g>
                                    <title>background</title>
                                    <rect x="-1" y="-1" width="112" height="112" id="canvas_background" fill="none"/>
                                    <g id="canvasGrid" display="none">
                                        <rect id="svg_3" width="100%" height="100%" x="0" y="0" stroke-width="0"
                                              fill="url(#gridpattern)"/>
                                    </g>
                                </g>
                                <g>
                                    <title>Layer 1</title>
                                    <rect fill="{{ line.color }}" stroke-width="0" x="15" y="0" width="20" height="10" id="svg_1"
                                          stroke="#000"/>
                                    <rect fill="{{ line.color }}" stroke-width="0" x="15" y="99.99998" width="20" height="10" id="svg_2"
                                          stroke="#000"/>
                                    <rect rx="10" fill="{{ line.color }}" stroke-width="0" stroke-opacity="null" fill-opacity="null"
                                          y="10" width="50" height="90" id="svg_4" stroke="#000"/>
                                    <rect rx="5" fill="#ffffff" stroke-width="0" stroke-opacity="null" x="9.85296" y="20"
                                          width="30" height="70" id="svg_5" stroke="#000"/>
                                    <rect stroke="#000" id="svg_7" height="30" width="30" y="40" x="9.80775"
                                          stroke-width="0" fill="{{ line.color }}"/>
                                    <text style="cursor: move;" fill="{{ line.color_text }}" stroke-width="0" stroke-opacity="null"
                                          x="13.20045" y="64.75061" id="svg_6" font-size="24" font-family="Euphoria, sans-serif"
                                          text-anchor="start" xml:space="preserve"
                                          transform="matrix(0.8899122355379762,0,0,1.0000902719207967,-2.254208887958093,-3.003364534707523) "
                                          stroke="#000" font-weight="bold" font-style="italic">ТЧ</text>
                                </g>
                            </svg>
                            {% else %}
                            <svg width="110" height="110" xmlns="http://www.w3.org/2000/svg">
                                <!-- Created with SVG Editor - http://github.com/mzalive/SVG Editor/ -->
                                <defs>
                                    <filter height="200%" width="200%" y="-50%" x="-50%" id="svg_7_blur">
                                        <feGaussianBlur stdDeviation="1" in="SourceGraphic"/>
                                    </filter>
                                </defs>
                                <g>
                                    <title>background</title>
                                    <rect x="-1" y="-1" width="112" height="112" id="canvas_background" fill="none"/>
                                    <g id="canvasGrid" display="none">
                                        <rect id="svg_3" width="100%" height="100%" x="0" y="0" stroke-width="0"
                                              fill="url(#gridpattern)"/>
                                    </g>
                                </g>
                                <g>
                                    <title>Layer 1</title>
                                    <rect fill="{{ line.color }}80" stroke-width="0" x="15" y="0" width="20" height="10" id="svg_1"
                                          stroke="#000"/>
                                    <rect fill="{{ line.color }}80" stroke-width="0" x="15" y="99.99998" width="20" height="10" id="svg_2"
                                          stroke="#000"/>
                                    <rect rx="10" fill="{{ line.color }}80" stroke-width="0" stroke-opacity="null" fill-opacity="null"
                                          y="10" width="50" height="90" id="svg_4" stroke="#000"/>
                                    <rect rx="5" fill="#ffffff" stroke-width="0" stroke-opacity="null" x="9.85296" y="20"
                                          width="30" height="70" id="svg_5" stroke="#000"/>
                                    <rect stroke="#000" id="svg_7" height="30" width="30" y="40" x="9.80775"
                                          stroke-width="0" fill="{{ line.color }}80"/>
                                    <text style="cursor: move;" fill="{{ line.color_text }}80" stroke-width="0" stroke-opacity="null"
                                          x="13.20045" y="64.75061" id="svg_6" font-size="24" font-family="Euphoria, sans-serif"
                                          text-anchor="start" xml:space="preserve"
                                          transform="matrix(0.8899122355379762,0,0,1.0000902719207967,-2.254208887958093,-3.003364534707523) "
                                          stroke="#000" font-weight="bold" font-style="italic">ТЧ</text>
                                </g>
                            </svg>
                            {% endif %}
                            {% if d.image %}
                            <img class="station_img" src="{{ d.image.url }}" alt="{{ d.title }}">
                            {% else %}
                            <img class="station_img" src="{% static 'images/plug.jpg' %}" alt="post_image">
                            {% endif %}
                        </a>

                        <div class="vertical_stations_info_block">
                            <a class="line_link_text" style="margin: 0 auto;" href="{{ d.get_absolute_url }}">
                                <div class="station_text">
                                    <h2 class="list_title">ТЧ-{{ d.number_of_depot }} {{ d.title | truncatechars:30 }}</h2>
                                    <p>Состояние: {{ d.status }}</p>
                                </div>
                            </a>
                        </div>
                    </li>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </ul>
        <div class="wrap_text">
            <h1>{{ line.title }}</h1>
            <p>{{ line.content | safe | linebreaksbr }}</p>
            {% if request.user.is_staff %}
                <a href="{% url 'update_line' line.slug %}">
                    <button class="mb-20 mt-20">Редактировать</button>
                </a>
            {% endif %}
        </div>
    </section>
</main>
{% endblock %}